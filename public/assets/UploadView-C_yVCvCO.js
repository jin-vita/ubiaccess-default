import{d as N,r as F,c as S,_ as w,o as d,a as p,b as t,F as C,e as k,f as D,t as v,s as q,g as O,u as T,n as x,h as B,i as L}from"./index-ljvht_VX.js";import{r as I,a as U,b as M}from"./index-Dv1oZ6ws.js";const P=N("files",()=>{const g=F([]),u=S(()=>g.value.length);return{files:g,filesCount:u,requestFileList:async()=>{const o="/nas/list";try{const r=await I(o);return console.log(`response -> ${JSON.stringify(r.data.output.body)}`),g.value=r.data.output.body,r.data}catch(r){return r.code==="ECONNABORTED"?console.log(`서버 요청 시 타임아웃 : ${U.timeout}`):console.error(`서버 요청 시 에러 : ${r.message}`),null}},requestFileUpload:async(o,r)=>new Promise(async(m,s)=>{console.log(`upload 호출됨 -> name : ${o.name}, type : ${o.type}`);try{let a=new FormData;a.append("photo",o);const i=await M.post(`${U.baseUrl}/nas/upload`,a,{headers:{"Content-Type":"multipart/form-data;charset=utf-8;"},onUploadProgress:_=>{const b=parseInt(_.loaded/_.total*100);r&&r(b)}});m(i.data)}catch(a){console.error(`에러 -> ${a}`),s(`에러 -> ${a}`)}})}}),R={class:"container"},E={__name:"FileUpload",setup(g){const u=P(),c=F([]),f=s=>s<1024?`${s} B`:s<1024**2?`${(s/1024).toFixed(2)} KB`:s<1024**3?`${(s/1024**2).toFixed(2)} MB`:`${(s/1024**3).toFixed(2)} GB`,o=s=>{c.value=Array.from(s.target.files),c.value=c.value.map(a=>({file:a,uploadProgress:0}))},r=()=>{c.value.forEach(s=>{m(s)}),console.log("파일이 업로드되었습니다!")};async function m(s){console.log(`uploadFile 호출됨 -> name : ${s.file.name}, type : ${s.file.type}`);try{const a=await u.requestFileUpload(s.file,i=>{s.uploadProgress=i,console.log(`업로드 progress : ${i}`)});console.log(`response -> ${JSON.stringify(a)}`)}catch(a){console.error(`에러 -> ${a}`)}}return(s,a)=>(d(),p("div",R,[a[0]||(a[0]=t("h2",null,"Upload Files (limit 10GB)",-1)),t("input",{type:"file",multiple:"",onChange:o},null,32),t("button",{onClick:r},"upload"),(d(!0),p(C,null,k(c.value,i=>(d(),p("div",{key:i.file.name},[D(v(i.file.name)+" ("+v(f(i.file.size))+" KB) ",1),t("span",null," - "+v(i.uploadProgress<100?`${i.uploadProgress}%`:"완료"),1)]))),128))]))}},V=w(E,[["__scopeId","data-v-1c6e425c"]]),A="/download.ico",G={class:"container"},K={class:"filename-column"},J=["onClick"],j={class:"pagination"},H=["disabled"],Y=["disabled"],Q=["onClick"],W=["disabled"],X=["disabled"],h=10,Z={__name:"FileList",setup(g){const u=P(),{files:c,filesCount:f}=q(u),o=F(1),r=S(()=>{const n=(o.value-1)*h;return c.value.slice(n,n+h)}),m=S(()=>Math.ceil(c.value.length/h)),s=n=>n<1024?`${n} B`:n<1024**2?`${(n/1024).toFixed(2)} KB`:n<1024**3?`${(n/1024**2).toFixed(2)} MB`:`${(n/1024**3).toFixed(2)} GB`,a=n=>{const e=new Date(Number(n)+324e5);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`},i=n=>{const l=n.lastIndexOf("."),e=n.slice(0,l).slice(0,-13),$=n.slice(l+1);return`${e}.${$}`},_=async n=>{console.log("handleFileClick");const l=U.baseUrl+"/uploads/";try{const e=await fetch(l+n);if(!e.ok)console.log(`Page not found or invalid URL: ${l+n}`);else{console.log(`Page exists, proceeding to URL. ${l+n}`);const $=await e.blob(),y=document.createElement("a");y.href=URL.createObjectURL($),y.download=i(n),y.click()}}catch(e){console.error("Error checking URL:",e)}},b=()=>{console.log("requestFilesList 호출됨.");try{u.requestFileList()}catch(n){console.error(`웹서버 요청 중 에러 발생 : ${n}`)}};return O(()=>{console.log("onMounted 호출됨."),b()}),(n,l)=>(d(),p("div",G,[t("h2",null,"File list (total "+v(T(f))+" items)",1),t("table",null,[l[5]||(l[5]=t("thead",null,[t("tr",null,[t("th",null,"Date"),t("th",null,"Name"),t("th",null,"Size"),t("th",null,"Action")])],-1)),t("tbody",null,[(d(!0),p(C,null,k(r.value,e=>(d(),p("tr",{key:e.name},[t("td",null,v(a(e.timestamp)),1),t("td",K,v(i(e.name)),1),t("td",null,v(s(e.size)),1),t("td",{class:"download-btn",onClick:$=>_(e.name)},l[4]||(l[4]=[t("img",{src:A,alt:"Download",class:"download-icon"},null,-1)]),8,J)]))),128))])]),t("div",j,[t("button",{onClick:l[0]||(l[0]=e=>o.value=1),disabled:o.value===1}," « ",8,H),t("button",{onClick:l[1]||(l[1]=e=>o.value--),disabled:o.value===1}," ‹ ",8,Y),(d(!0),p(C,null,k(m.value,e=>(d(),p("button",{key:e,class:x({active:o.value===e}),onClick:$=>o.value=e},v(e),11,Q))),128)),t("button",{onClick:l[2]||(l[2]=e=>o.value++),disabled:o.value>=m.value}," › ",8,W),t("button",{onClick:l[3]||(l[3]=e=>o.value=m.value),disabled:o.value>=m.value}," » ",8,X)])]))}},z=w(Z,[["__scopeId","data-v-9578dd15"]]),ee={key:0},te={key:1},oe={__name:"UploadView",setup(g){const u=F("list");function c(f){u.value=f}return(f,o)=>(d(),p("div",null,[t("nav",null,[t("button",{onClick:o[0]||(o[0]=r=>c("list")),class:x({active:u.value==="list"})}," 리스트 ",2),t("button",{onClick:o[1]||(o[1]=r=>c("upload")),class:x({active:u.value==="upload"})}," 업로드 ",2)]),u.value==="upload"?(d(),p("div",ee,[B(V)])):L("",!0),u.value==="list"?(d(),p("div",te,[B(z)])):L("",!0)]))}},le=w(oe,[["__scopeId","data-v-4462c54a"]]);export{le as default};
