import{d as P,r as y,c as k,_ as U,o as p,a as m,b as t,F as w,e as x,f as O,t as v,s as T,g as E,u as R,n as D,h as B,i as N}from"./index-Dsp5gfVx.js";import{r as q,a as F,b as I}from"./index-Dv1oZ6ws.js";const L=P("files",()=>{const g=y([]),u=k(()=>g.value.length);return{files:g,filesCount:u,requestFileList:async()=>{const i="/nas/list";try{const a=await q(i);return console.log(`response -> ${JSON.stringify(a.data.output.body)}`),g.value=a.data.output.body,a.data}catch(a){return a.code==="ECONNABORTED"?console.log(`서버 요청 시 타임아웃 : ${F.timeout}`):console.error(`서버 요청 시 에러 : ${a.message}`),null}},requestFileDelete:async i=>{const a="/nas/delete";try{const o=await q(a,i);return console.log(`response -> ${JSON.stringify(o.data.output.body)}`),o.data}catch(o){return o.code==="ECONNABORTED"?console.log(`서버 요청 시 타임아웃 : ${F.timeout}`):console.error(`서버 요청 시 에러 : ${o.message}`),null}},requestFileUpload:async(i,a)=>new Promise(async(o,d)=>{console.log(`upload 호출됨 -> name : ${i.name}, type : ${i.type}`);try{let r=new FormData;r.append("photo",i);const b=await I.post(`${F.baseUrl}/nas/upload`,r,{headers:{"Content-Type":"multipart/form-data;charset=utf-8;"},onUploadProgress:_=>{const h=parseInt(_.loaded/_.total*100);a&&a(h)}});o(b.data)}catch(r){console.error(`에러 -> ${r}`),d(`에러 -> ${r}`)}})}}),M={class:"container"},V={__name:"FileUpload",setup(g){const u=L(),c=y([]),f=o=>o<1024?`${o} B`:o<1024**2?`${(o/1024).toFixed(2)} KB`:o<1024**3?`${(o/1024**2).toFixed(2)} MB`:`${(o/1024**3).toFixed(2)} GB`,l=o=>{c.value=Array.from(o.target.files),c.value=c.value.map(d=>({file:d,uploadProgress:0}))},i=()=>{c.value.forEach(o=>{a(o)}),console.log("파일이 업로드되었습니다!")};async function a(o){console.log(`uploadFile 호출됨 -> name : ${o.file.name}, type : ${o.file.type}`);try{const d=await u.requestFileUpload(o.file,r=>{o.uploadProgress=r,console.log(`업로드 progress : ${r}`)});console.log(`response -> ${JSON.stringify(d)}`)}catch(d){console.error(`에러 -> ${d}`)}}return(o,d)=>(p(),m("div",M,[d[0]||(d[0]=t("h2",null,"Upload Files (limit 10GB)",-1)),t("input",{type:"file",multiple:"",onChange:l},null,32),t("button",{onClick:i},"upload"),(p(!0),m(w,null,x(c.value,r=>(p(),m("div",{key:r.file.name},[O(v(r.file.name)+" ("+v(f(r.file.size))+" KB) ",1),t("span",null," - "+v(r.uploadProgress<100?`${r.uploadProgress}%`:"완료"),1)]))),128))]))}},A=U(V,[["__scopeId","data-v-1c6e425c"]]),G="/download.ico",J="/assets/delete-DHlDl9-h.png",K={class:"container"},H={class:"filename-column"},j=["onClick"],Y=["onClick"],Q={class:"pagination"},W=["disabled"],X=["disabled"],Z=["onClick"],z=["disabled"],ee=["disabled"],S=8,te={__name:"FileList",setup(g){const u=L(),{files:c,filesCount:f}=T(u),l=y(1),i=k(()=>{const s=(l.value-1)*S;return c.value.slice(s,s+S)}),a=k(()=>Math.ceil(c.value.length/S)),o=s=>s<1024?`${s} B`:s<1024**2?`${(s/1024).toFixed(2)} KB`:s<1024**3?`${(s/1024**2).toFixed(2)} MB`:`${(s/1024**3).toFixed(2)} GB`,d=s=>{const e=new Date(Number(s)+324e5);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`},r=s=>{const n=s.lastIndexOf("."),e=s.slice(0,n).slice(0,-13),$=s.slice(n+1);return`${e}.${$}`},b=async s=>{console.log("handleFileClick");const n=F.baseUrl+"/uploads/";try{const e=await fetch(n+s);if(!e.ok)console.log(`Page not found or invalid URL: ${n+s}`);else{console.log(`Page exists, proceeding to URL. ${n+s}`);const $=await e.blob(),C=document.createElement("a");C.href=URL.createObjectURL($),C.download=r(s),C.click()}}catch(e){console.error("Error checking URL:",e)}},_=()=>{console.log("requestFilesList 호출됨.");try{u.requestFileList()}catch(s){console.error(`웹서버 요청 중 에러 발생 : ${s}`)}},h=async s=>{console.log("deleteFile 호출됨.");try{const n={requestCode:"1001",file:s};await u.requestFileDelete(n),_(),i.value.length===1&&l.value--}catch(n){console.error(`웹서버 요청 중 에러 발생 : ${n}`)}};return E(()=>{console.log("onMounted 호출됨."),_()}),(s,n)=>(p(),m("div",K,[t("h2",null,"File list (total "+v(R(f))+" items)",1),t("table",null,[n[6]||(n[6]=t("thead",null,[t("tr",null,[t("th",null,"Date"),t("th",null,"Name"),t("th",null,"Size"),t("th",null,"✅"),t("th",null,"❌")])],-1)),t("tbody",null,[(p(!0),m(w,null,x(i.value,e=>(p(),m("tr",{key:e.name},[t("td",null,v(d(e.timestamp)),1),t("td",H,v(r(e.name)),1),t("td",null,v(o(e.size)),1),t("td",{class:"download-btn",onClick:$=>b(e.name)},n[4]||(n[4]=[t("img",{src:G,alt:"Download",class:"icon"},null,-1)]),8,j),t("td",{class:"download-btn",onClick:$=>h(e.name)},n[5]||(n[5]=[t("img",{src:J,alt:"delete",class:"icon"},null,-1)]),8,Y)]))),128))])]),t("div",Q,[t("button",{onClick:n[0]||(n[0]=e=>l.value=1),disabled:l.value===1}," « ",8,W),t("button",{onClick:n[1]||(n[1]=e=>l.value--),disabled:l.value===1}," ‹ ",8,X),(p(!0),m(w,null,x(a.value,e=>(p(),m("button",{key:e,class:D({active:l.value===e}),onClick:$=>l.value=e},v(e),11,Z))),128)),t("button",{onClick:n[2]||(n[2]=e=>l.value++),disabled:l.value>=a.value}," › ",8,z),t("button",{onClick:n[3]||(n[3]=e=>l.value=a.value),disabled:l.value>=a.value}," » ",8,ee)])]))}},oe=U(te,[["__scopeId","data-v-5a7a1029"]]),se={key:0},ne={key:1},le={__name:"UploadView",setup(g){const u=y("list");function c(f){u.value=f}return(f,l)=>(p(),m("div",null,[t("nav",null,[t("button",{onClick:l[0]||(l[0]=i=>c("list")),class:D({active:u.value==="list"})}," 리스트 ",2),t("button",{onClick:l[1]||(l[1]=i=>c("upload")),class:D({active:u.value==="upload"})}," 업로드 ",2)]),u.value==="upload"?(p(),m("div",se,[B(A)])):N("",!0),u.value==="list"?(p(),m("div",ne,[B(oe)])):N("",!0)]))}},ie=U(le,[["__scopeId","data-v-410daded"]]);export{ie as default};
